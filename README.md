# ModulePassageway-
模块间通信（相互调用）
## 前言 ##
在18年年初到21年这段时间，本人在咪咕阅读项目组担任android开发3年的时间，从业务开发再到公共组件/中间组件的封装的实践中学会如何通过设计模式结合一些许多公司的一些公共特性，去更好的改善代码的质量以及效率。这里很感谢公司的信任以及同事的帮助。
这段时间，小弟一直在梳理以及沉淀这几年的开发过程中学到的东西，然后经过思考，有必要对模块间的通信架构做一下总结和探讨。
## 背景 ##
很多公司在app的开发过程中，伴随着公司的发展，业务也逐渐壮大，那么自然而然项目就会变得十分的臃肿，开发人员为了解决项目的臃肿问题，会使用一些设计模式，对架构、中间件、业务模块进行分离，这样。模块化（组件化）的开发工作便随之展开，在网上有很多优秀的模块化的解决方案，这些方案都会清晰的告诉我们，模块化需要对项目需要做以下几项比较重要的工作。
1. 对项目本身进行梳理，将项目分为以下几类：架构层、能力层、公共组件、业务组件等
2. 解决模块之间的路由跳转（这里阿里的ARoute是一个比较强大的路由跳转框架）
3. 解决模块间的通信（也就是相互调用的问题，大家这里就会想到EventBus）
这篇文章主要是针对第3点展开的，写这篇文章的目的不是为了提供大家一个模块间通讯的框架，而是沉淀一下，但是我们做模块间的通讯做过哪些的思考。

首先我们先思考如下一个问题：
在项目中我们有以下几个module

项目入口： |              main                |
业务组件： | 阅读 | 听书 | tts | 视频 | 漫画 | 广告 | 个人中心 |
公共组件： | 分享 | 日志 | 公共控件 | 扫码 | 资费 | 定位 | 皮肤 | 广告 |
基础组件： | 网络 | 图片加载 | 线程切换 | 数据库 | 文件管理系统 | 推送 |

这个时候，如果有一个场景，是需要下层调用上层的时候，我们知道android是单向依赖的，被引用的module是无法直接调用引用的module，例如皮肤是直接无法调用视频相关的API的，那么这个时候，有以下两个选项：
1. 在基础组件里面定义模块通讯的管理者，通过接口的方式，间接进行调用。即：A依赖B、C模块，B依赖C模块，然后都将自己提供的API注册到C里面，那么是可以实现B调用C的
2. EventBus的使用（这个大家应该很熟悉的）

然而EventBus是一种观察者监听者的模式，他会轮询所有注册过的类个方法，不适用我们当时单一调用的准则。
当时在项目中，我们使用的是第1种方式，但是这种方式有一个不好的地方，开发人员每次新增一个场景的时候，就需要新增大量的代码，而且新来的开发人员对这些不了解的话，学习和使用成本很高，不便于维护和使用，所以为了让后来的开发人员更加方便的可以进行模块间的通信，我们这里借鉴了EventBus的开发原理，将第1个方式进行更改。使用了注解的方式，让所有的有对应的业务场景的服务，通过往一个基础组件类里面去注册一个服务，然后通过JavaPoet在编译的时候实时生成对应的java代码，这样方便开发人员的调用。
